<!DOCTYPE html>  <html> <head>   <title>degrees.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="degrees.html">                 degrees.coffee               </a>                                           <a class="source" href="gaia.html">                 gaia.coffee               </a>                                           <a class="source" href="ut.html">                 ut.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               degrees.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span>


<span class="k">class</span> <span class="nx">DegreesBase</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Unacceptable initial value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">dec: </span><span class="kc">NaN</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Requirements to be overriden by sub-classes as needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">abs: </span><span class="kc">false</span> <span class="c1"># must be / remain absolute (i.e. a positive value)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Ensuring a <code>@dec</code> (decimal degrees) number to work with.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@given) -&gt;</span>

    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span> <span class="nx">@given</span> <span class="k">then</span> <span class="vi">@dec = </span><span class="nx">@given</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>DMS: <code>[degrees]</code> or <code>[degrees, minutes]</code> or <code>[degrees, minutes, seconds]</code>.
Note: chain-call @neg to get a negative @dec from dms.
All of the degrees, minutes or seconds are being taken as absolute values.
TODO: consider taking decimal degrees or minutes, even through the array?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">@given</span>
      <span class="nx">unless</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">@given</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
        <span class="k">throw</span> <span class="s2">&quot;The given array must at least have degrees, and at most seconds.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>TODO: figure out why the following validation isn't working:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <pre><code>unless _.all @given, (x) -&gt; _.isNumber x
  throw "Expecting the given array #{@given} to be all-number(s)."
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Note: integers are expected, discarding aything after the decimal.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@dec = </span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@given</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nx">@dec</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@given</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">60</span>   <span class="k">if</span> <span class="nx">@given</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="c1"># mins</span>
      <span class="nx">@dec</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@given</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">3600</span> <span class="k">if</span> <span class="nx">@given</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="c1"># secs</span>

    <span class="k">else</span> <span class="k">throw</span> <span class="s2">&quot;Unexpected &#39;#{typeof(@given)}&#39; type of degrees given.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The positive (i.e. absolute) angle - whole int or decimal.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@abs</span> <span class="k">then</span> <span class="vi">@dec = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@dec</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Ensures the degrees are negative.  Useful for geo-coordinates.
This was introduced for easier instantiation with a dms array.
The @pos opposite could also be added, but that means variable degrees...
So far this is the only method besides the constructor(s) that modify @dec.
Therefore a one-time-deal without undo.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">neg: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@abs</span> <span class="k">then</span> <span class="vi">@dec = </span><span class="mi">0</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@dec</span>
    <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Just so one can get the decimal degrees with a method call rather than
with <code>@deg</code> (the only property).  So that to have less of special cases...
See CelestialLongitude.representation('the') as an example of wanting more.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">the: </span><span class="o">-&gt;</span> <span class="nx">@dec</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Radians.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rad: </span><span class="o">-&gt;</span>
    <span class="nx">@dec</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="err">/ 180</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Array of [sign, degrees, minutes, seconds] for the standard acronym.
Note: that we can't do fractional seconds (as a result of not taking them).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">dms: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Empty string for plus will make it easier to display.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">n = </span><span class="k">if</span> <span class="nx">@dec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="s1">&#39;-&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="nv">dec = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@dec</span>
    <span class="nv">d = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span>  <span class="nx">dec</span>
    <span class="nv">m = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">dec</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>   <span class="o">%</span> <span class="mi">60</span><span class="p">)</span> <span class="c1"># 0 &lt;= m &lt; 60</span>
    <span class="nv">s = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">dec</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span> <span class="c1"># 0 &lt;= s &lt; 60</span>
    <span class="p">[</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">s</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>A string (with unicode characters after the degrees, minutes and seconds).
Fist, but not least, it starts with '-' (minus) if negative.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">str: </span><span class="o">-&gt;</span>
    <span class="p">[</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">s</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">@dms</span><span class="p">()</span>
    <span class="s2">&quot;#{n}#{d}\u00B0#{m}\u2032#{s}\u2033&quot;</span>

  <span class="nv">unimplemented: </span><span class="nf">(method) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>mod x</code> = degrees % modulo <br/>
<code>num n</code> = convert to the n-th harmonic <br/></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">throw</span> <span class="s2">&quot;The wanted &#39;#{method}&#39; method is not implemented yet.&quot;</span>


<span class="k">class</span> <span class="nx">CelestialLongitude</span> <span class="k">extends</span> <span class="nx">DegreesBase</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>See DegreesBase.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">abs: </span><span class="kc">true</span> <span class="c1"># absolutely always positive</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Longitude degrees are special.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@given) -&gt;</span>
    <span class="k">super</span> <span class="nx">@given</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Ensure [0..360] range, however the pure 0 can't be had.
It throws off various calculations, think about doing the same for base...
unless @dec is 0 # the only way to have 0 is be given a 0 (no longer true)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@dec</span> <span class="o">%=</span> <span class="mi">360</span> <span class="c1"># smaller modulos can be done with `mod n` modification</span>
    <span class="vi">@dec = </span><span class="mi">360</span> <span class="k">if</span> <span class="nx">@dec</span> <span class="o">is</span> <span class="mi">0</span> <span class="c1"># exact multiples of 360 equal 360 degrees, again</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Is portion (or degree in modern parlance).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">top: </span><span class="o">-&gt;</span>
    <span class="nv">portion = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span> <span class="nx">@dec</span>
    <span class="nv">portion = </span><span class="mi">360</span> <span class="k">if</span> <span class="nx">portion</span> <span class="o">is</span> <span class="mi">0</span> <span class="c1"># there is no zero portion (= whole circle)</span>
    <span class="nx">portion</span>

  <span class="nv">portion: </span><span class="o">-&gt;</span>
    <span class="nx">@top</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The returned [0..11, 0..29] is [representation, portion] array index.
Perhaps not used - it doesn't hurt to keep it around for a while longer.
It no longer has special logic but it does test <code>@rep 'top'</code> quite well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">idx: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">image</span><span class="p">,</span> <span class="nx">portion</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@rep</span> <span class="s1">&#39;top&#39;</span>
    <span class="p">[</span><span class="o">--</span><span class="nx">image</span><span class="p">,</span> <span class="o">--</span><span class="nx">portion</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>The 1 to 12 for image / representation (modern "sign" number).
Request more and get a representation-first array, followed by that more,
where more is a string that matches a method name (e.g. 'top', 'dms')
for further getting the rest of the @dec degrees in a representation context.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rep: </span><span class="nf">(more) -&gt;</span>
    <span class="nv">rep = </span><span class="k">if</span> <span class="nx">@dec</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">@dec</span> <span class="o">is</span> <span class="mi">360</span> <span class="k">then</span> <span class="mi">12</span> <span class="k">else</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">@dec</span> <span class="err">/ 30)</span>

    <span class="k">switch</span> <span class="nx">more</span>
      <span class="k">when</span> <span class="kc">undefined</span> <span class="k">then</span> <span class="nx">rep</span>
      <span class="k">when</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span>
        <span class="p">[</span><span class="nx">rep</span><span class="p">,</span> <span class="p">(</span><span class="err">@</span><span class="p">[</span><span class="nx">more</span><span class="p">]()</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rep</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)]</span>
      <span class="k">else</span> <span class="nx">@unimplemented</span> <span class="s2">&quot;rep(&#39;#{more}&#39;)&quot;</span>


  <span class="nv">representation: </span><span class="nf">(more) -&gt;</span>
    <span class="nx">@rep</span><span class="p">(</span><span class="nx">more</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The 12th part higher-level representation (1 to 12 again).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_12: </span><span class="nf">(exact = false) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>is p12: -> #better?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@unimplemented</span><span class="p">(</span><span class="s1">&#39;p12&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nx">Degrees</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>A Factory Method Class</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">of</span><span class="o">:</span> <span class="nf">(given , base = true) -&gt;</span>
    <span class="k">switch</span> <span class="nx">base</span>
      <span class="k">when</span> <span class="kc">true</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">DegreesBase</span> <span class="nx">given</span>
      <span class="k">when</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">CelestialLongitude</span> <span class="nx">given</span>
      <span class="k">else</span> <span class="k">throw</span> <span class="s2">&quot;Unknown kind of #{base} degrees.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Alias for <code>@of x, 'lon'</code> - nice, short, consistent.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">lon: </span><span class="nf">(given, rep) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Takes an optional representation - 1 for the Ram to 12 for the Fishes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">rep</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">rep</span><span class="p">)</span> <span class="o">and</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">rep</span> <span class="o">&lt;=</span> <span class="mi">12</span>
        <span class="nv">rep = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">rep</span>
        <span class="nv">add = </span><span class="p">(</span><span class="nx">rep</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span>

        <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span> <span class="nx">given</span> <span class="k">then</span> <span class="nx">given</span> <span class="o">+=</span> <span class="nx">add</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">given</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span> <span class="nx">given</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">then</span> <span class="nx">given</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">add</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>The degrees and representation must be numbers / valid.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="k">throw</span> <span class="s2">&quot;The given #{given} degrees can&#39;t be added to.&quot;</span>
      <span class="k">else</span> <span class="k">throw</span> <span class="s2">&quot;Invalid representation #{rep}.&quot;</span>

    <span class="nx">@of</span> <span class="nx">given</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span>


<span class="nv">module.exports = </span><span class="k">new</span> <span class="nx">Degrees</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 